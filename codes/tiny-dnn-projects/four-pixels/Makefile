#-------------------------------------------------------------------------------
SHELL	=/bin/bash
#-------------------------------------------------------------------------------
#CXX	=g++-4.9
CXX	=g++
TINY_DNN=${TINYDNN_HOME}
CXXFLAGS=-I$(TINY_DNN) -std=c++14 -pthread -O2
LDFLAGS	=
LDLIBS	=-lpthread
#-------------------------------------------------------------------------------
.cpp.o:; $(CXX) -c $< $(CXXFLAGS) 2>&1 | tee compile.log.$*

#-------------------------------------------------------------------------------
all: train test

#-------------------------------------------------------------------------------
train: train.o
	$(CXX) -o $@ $^ $(LDFLAGS) $(LDLIBS) 2>&1 | tee -a compile.log.$@

#-------------------------------------------------------------------------------
test: test.o
	$(CXX) -o $@ $^ $(LDFLAGS) $(LDLIBS) 2>&1 | tee -a compile.log.$@

#-------------------------------------------------------------------------------
run: train test
	./train -e 10000
	./test 0 0 0 0
	./test 0 1 1 0
	./test 1 0 0 1
	./test 1 1 1 1

#-------------------------------------------------------------------------------
learn: train
	./train -e 15000

#-------------------------------------------------------------------------------
inference: test
	./test 0 0 0 0
	./test 1 1 1 1
	./test 1 0 1 0
	./test 0 1 0 1
	./test 1 1 0 0
	./test 0 0 1 1
	./test 1 0 0 1
	./test 0 1 1 0

#-------------------------------------------------------------------------------
.PHONY: clean cleanup

clean:
	/bin/rm -f train.o compile.log.train
	/bin/rm -f test.o compile.log.test

cleanup: clean
	/bin/rm -f train
	/bin/rm -f test
	/bin/rm -f pixel_net pixel_net_json

cleanupall: cleanup

#-------------------------------------------------------------------------------
